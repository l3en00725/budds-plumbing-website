---
import {
  Container,
  TextCardSection,
} from '@components/odyssey-theme';
import Layout from '../../layouts/Page.astro';
import settings from '../../config/settings';

// Get all service pages
const servicePages = await Astro.glob('../../content/services/*.md');

// Sort services alphabetically by title
const services = servicePages
  .map(({ frontmatter }) => ({
    title: frontmatter.title,
    description: frontmatter.description,
    slug: frontmatter.slug,
    heroImage: frontmatter.heroImage,
    heroAlt: frontmatter.heroAlt,
  }))
  .sort((a, b) => a.title.localeCompare(b.title));

// Group services by category (emergency, installation, repair, etc.)
const emergencyServices = services.filter(s =>
  s.title.toLowerCase().includes('emergency')
);
const installationServices = services.filter(s =>
  s.title.toLowerCase().includes('installation') ||
  s.title.toLowerCase().includes('water heater')
);
const repairServices = services.filter(s =>
  s.title.toLowerCase().includes('repair') ||
  s.title.toLowerCase().includes('leak') ||
  s.title.toLowerCase().includes('drain') ||
  s.title.toLowerCase().includes('sewer') ||
  s.title.toLowerCase().includes('pipe')
);
const otherServices = services.filter(s =>
  !emergencyServices.includes(s) &&
  !installationServices.includes(s) &&
  !repairServices.includes(s)
);

// Build canonical URL
const canonicalURL = new URL('/services', settings.url);

// ItemList Schema for Services
const itemListSchema = {
  "@context": "https://schema.org",
  "@type": "ItemList",
  "name": "Plumbing Services",
  "description": "Complete plumbing services in Cape May County, NJ",
  "itemListElement": services.map((service, index) => ({
    "@type": "ListItem",
    "position": index + 1,
    "item": {
      "@type": "Service",
      "name": service.title,
      "description": service.description,
      "url": new URL(`/services/${service.slug}`, settings.url).toString(),
      "provider": {
        "@type": "LocalBusiness",
        "name": settings.name,
        "telephone": "(609) 465-3759",
        "url": settings.url
      }
    }
  }))
};

// Breadcrumb Schema
const breadcrumbSchema = {
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "name": "Home",
      "item": settings.url
    },
    {
      "@type": "ListItem",
      "position": 2,
      "name": "Services",
      "item": canonicalURL.toString()
    }
  ]
};

// SEO configuration
const seo = {
  title: `Plumbing Services in Cape May County, NJ | ${settings.name}`,
  description: `Professional plumbing services including emergency repairs, installations, drain cleaning, and more. Serving Cape May County, NJ. Call (609) 465-3759.`,
  canonicalURL: canonicalURL.toString(),
};
---

<Layout {seo}>
  <!-- ItemList Schema -->
  <script type="application/ld+json" set:html={JSON.stringify(itemListSchema)} />

  <!-- Breadcrumb Schema -->
  <script type="application/ld+json" set:html={JSON.stringify(breadcrumbSchema)} />

  <!-- Breadcrumb Navigation -->
  <Container>
    <nav aria-label="Breadcrumb" class="breadcrumb">
      <ol class="breadcrumb__list">
        <li class="breadcrumb__item">
          <a href="/" class="breadcrumb__link">Home</a>
        </li>
        <li class="breadcrumb__item breadcrumb__item--active" aria-current="page">
          Services
        </li>
      </ol>
    </nav>
  </Container>

  <Container>
    <!-- Header Section -->
    <TextCardSection>
      <h1>Our Plumbing Services</h1>
      <p class="services-intro">
        Budd's Plumbing, Heating & Cooling provides comprehensive plumbing services
        throughout Cape May County, Atlantic County, and Cumberland County, New Jersey.
        From 24/7 emergency repairs to new installations, our licensed master plumbers
        deliver professional service you can trust.
      </p>
      <div class="services-cta">
        <a href="tel:+16094653759" class="button button--primary">
          Call (609) 465-3759
        </a>
        <a href="/company/contact" class="button button--secondary">
          Request Service
        </a>
      </div>
    </TextCardSection>

    <!-- Emergency Services -->
    {emergencyServices.length > 0 && (
      <section class="services-section">
        <h2 class="services-section__title">24/7 Emergency Services</h2>
        <p class="services-section__description">
          Immediate response for plumbing emergencies throughout Cape May County and surrounding areas.
        </p>
        <div class="services-grid">
          {emergencyServices.map((service) => (
            <a href={`/services/${service.slug}`} class="service-card">
              <div class="service-card__content">
                <h3 class="service-card__title">
                  {service.title.replace(` | ${settings.name}`, '').replace(` - ${settings.name}`, '')}
                </h3>
                <p class="service-card__description">{service.description}</p>
                <span class="service-card__link">Learn More →</span>
              </div>
            </a>
          ))}
        </div>
      </section>
    )}

    <!-- Installation Services -->
    {installationServices.length > 0 && (
      <section class="services-section">
        <h2 class="services-section__title">Installation Services</h2>
        <p class="services-section__description">
          Professional installation of water heaters, fixtures, and plumbing systems.
        </p>
        <div class="services-grid">
          {installationServices.map((service) => (
            <a href={`/services/${service.slug}`} class="service-card">
              <div class="service-card__content">
                <h3 class="service-card__title">
                  {service.title.replace(` | ${settings.name}`, '').replace(` - ${settings.name}`, '')}
                </h3>
                <p class="service-card__description">{service.description}</p>
                <span class="service-card__link">Learn More →</span>
              </div>
            </a>
          ))}
        </div>
      </section>
    )}

    <!-- Repair Services -->
    {repairServices.length > 0 && (
      <section class="services-section">
        <h2 class="services-section__title">Repair Services</h2>
        <p class="services-section__description">
          Expert repair services for leaks, clogs, and plumbing system issues.
        </p>
        <div class="services-grid">
          {repairServices.map((service) => (
            <a href={`/services/${service.slug}`} class="service-card">
              <div class="service-card__content">
                <h3 class="service-card__title">
                  {service.title.replace(` | ${settings.name}`, '').replace(` - ${settings.name}`, '')}
                </h3>
                <p class="service-card__description">{service.description}</p>
                <span class="service-card__link">Learn More →</span>
              </div>
            </a>
          ))}
        </div>
      </section>
    )}

    <!-- Other Services -->
    {otherServices.length > 0 && (
      <section class="services-section">
        <h2 class="services-section__title">Additional Services</h2>
        <p class="services-section__description">
          Comprehensive plumbing services for residential and commercial properties.
        </p>
        <div class="services-grid">
          {otherServices.map((service) => (
            <a href={`/services/${service.slug}`} class="service-card">
              <div class="service-card__content">
                <h3 class="service-card__title">
                  {service.title.replace(` | ${settings.name}`, '').replace(` - ${settings.name}`, '')}
                </h3>
                <p class="service-card__description">{service.description}</p>
                <span class="service-card__link">Learn More →</span>
              </div>
            </a>
          ))}
        </div>
      </section>
    )}

    <!-- Service Areas -->
    <section class="service-areas">
      <h2>Service Areas</h2>
      <p>
        We proudly serve Cape May County, Atlantic County, and Cumberland County, New Jersey,
        including Ocean City, Wildwood, Stone Harbor, Avalon, Cape May, Atlantic City,
        Vineland, Millville, and surrounding communities.
      </p>
    </section>

    <!-- Final CTA -->
    <section class="final-cta">
      <h2>Ready to Schedule Service?</h2>
      <p>
        Contact Budd's Plumbing, Heating & Cooling today for professional plumbing services
        throughout South Jersey.
      </p>
      <div class="final-cta__actions">
        <a href="tel:+16094653759" class="button button--primary button--large">
          Call (609) 465-3759
        </a>
        <a href="/company/contact" class="button button--secondary button--large">
          Request Service Online
        </a>
      </div>
    </section>
  </Container>
</Layout>

<style>
  /* Breadcrumb */
  .breadcrumb {
    padding: 1rem 0;
    margin-bottom: 2rem;
  }

  .breadcrumb__list {
    display: flex;
    flex-wrap: wrap;
    list-style: none;
    padding: 0;
    margin: 0;
    gap: 0.5rem;
    font-size: var(--font-size-sm);
  }

  .breadcrumb__item {
    display: flex;
    align-items: center;
  }

  .breadcrumb__item:not(:last-child)::after {
    content: '›';
    margin-left: 0.5rem;
    color: var(--theme-text-secondary);
  }

  .breadcrumb__link {
    color: var(--theme-primary);
    text-decoration: none;
  }

  .breadcrumb__link:hover {
    text-decoration: underline;
  }

  .breadcrumb__item--active {
    color: var(--theme-text-secondary);
  }

  /* Header Section */
  .services-intro {
    font-size: var(--font-size-lg);
    line-height: 1.7;
    margin: 2rem 0;
  }

  .services-cta {
    display: flex;
    flex-wrap: wrap;
    gap: 1rem;
    margin-top: 2rem;
  }

  /* Services Sections */
  .services-section {
    margin: 4rem 0;
  }

  .services-section__title {
    font-size: clamp(1.75rem, 4vw, 2.5rem);
    margin-bottom: 1rem;
  }

  .services-section__description {
    font-size: var(--font-size-lg);
    color: var(--theme-text-secondary);
    margin-bottom: 2rem;
  }

  /* Services Grid */
  .services-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
    gap: 2rem;
    margin-top: 2rem;
  }

  .service-card {
    display: block;
    background: var(--theme-surface-1);
    border: 1px solid var(--theme-border);
    border-radius: var(--theme-shape-radius);
    padding: 2rem;
    text-decoration: none;
    transition: all 0.3s ease;
    height: 100%;
  }

  .service-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
    border-color: var(--theme-primary);
  }

  .service-card__content {
    height: 100%;
    display: flex;
    flex-direction: column;
  }

  .service-card__title {
    font-size: var(--font-size-lg);
    margin-bottom: 1rem;
    color: var(--theme-text-primary);
    line-height: 1.3;
  }

  .service-card__description {
    color: var(--theme-text-secondary);
    line-height: 1.6;
    flex-grow: 1;
    margin-bottom: 1rem;
    font-size: var(--font-size-sm);
  }

  .service-card__link {
    color: var(--theme-primary);
    font-weight: 600;
    font-size: var(--font-size-sm);
  }

  .service-card:hover .service-card__link {
    text-decoration: underline;
  }

  /* Service Areas */
  .service-areas {
    background: var(--theme-surface-2);
    border-radius: var(--theme-shape-radius);
    padding: 3rem 2rem;
    margin: 4rem 0;
    text-align: center;
  }

  .service-areas h2 {
    margin-bottom: 1rem;
    font-size: clamp(1.5rem, 4vw, 2rem);
  }

  .service-areas p {
    font-size: var(--font-size-lg);
    line-height: 1.7;
    max-width: 800px;
    margin: 0 auto;
  }

  /* Final CTA */
  .final-cta {
    text-align: center;
    padding: 4rem 2rem;
    margin: 4rem 0 2rem;
  }

  .final-cta h2 {
    font-size: clamp(1.75rem, 4vw, 2.5rem);
    margin-bottom: 1rem;
  }

  .final-cta p {
    font-size: var(--font-size-lg);
    max-width: 700px;
    margin: 0 auto 2rem;
    line-height: 1.7;
  }

  .final-cta__actions {
    display: flex;
    flex-wrap: wrap;
    gap: 1rem;
    justify-content: center;
  }

  /* Buttons */
  .button {
    display: inline-block;
    padding: 1rem 2rem;
    border-radius: var(--theme-shape-radius);
    text-decoration: none;
    font-weight: 600;
    transition: all 0.2s ease;
    text-align: center;
  }

  .button--large {
    padding: 1.25rem 2.5rem;
    font-size: var(--font-size-lg);
  }

  .button--primary {
    background: var(--theme-primary);
    color: white;
  }

  .button--primary:hover {
    background: var(--theme-primary-hover);
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
  }

  .button--secondary {
    background: var(--theme-surface-1);
    color: var(--theme-text-primary);
    border: 2px solid var(--theme-border);
  }

  .button--secondary:hover {
    background: var(--theme-surface-2);
    border-color: var(--theme-primary);
    transform: translateY(-2px);
  }

  /* Responsive Design */
  @media (max-width: 768px) {
    .services-grid {
      grid-template-columns: 1fr;
      gap: 1.5rem;
    }

    .service-card {
      padding: 1.5rem;
    }

    .services-cta,
    .final-cta__actions {
      flex-direction: column;
      align-items: stretch;
    }

    .button {
      width: 100%;
    }

    .service-areas,
    .final-cta {
      padding: 2rem 1rem;
    }
  }
</style>
